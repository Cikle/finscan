<!DOCTYPE html>
<html>

<head>
    <title>Stock Data Chart Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        h1,
        h2 {
            color: #333;
        }

        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .input-section {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
        }

        .chart-section {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .chart-container {
            width: 100%;
            max-width: 580px;
            height: 300px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }

        textarea {
            width: 100%;
            height: 200px;
            font-family: monospace;
            padding: 10px;
            margin-top: 10px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }

        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }

        button:hover {
            background-color: #45a049;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        .trend-positive {
            color: #4CAF50;
        }

        .trend-negative {
            color: #f44336;
        }

        .rating {
            text-align: center;
            font-size: 18px;
            margin: 10px 0;
            font-weight: bold;
        }

        .rating-strong {
            color: #2e7d32;
        }

        .rating-good {
            color: #4CAF50;
        }

        .rating-neutral {
            color: #9e9e9e;
        }

        .rating-warning {
            color: #f9a825;
        }

        .rating-poor {
            color: #f44336;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <h1>Stock Data Chart Generator</h1>
    <p>This tool helps you visualize stock data that might not be showing correctly in generated reports.</p>

    <div class="container">
        <div class="input-section">
            <h2>1. Input Stock Data</h2>
            <p>Paste your stock data here (Finviz data format preferred):</p>
            <textarea id="stockDataInput" placeholder="Example:
Market Cap: 2.88T
Income: 383.29B
Sales: 383.93B
Book/sh: 4.99
Cash/sh: 3.64
Dividend: 0.96
Dividend %: 0.48%
Employees: 164000
Recom: 1.80
P/E: 31.67
Forward P/E: 28.22
P/S: 7.51
P/B: 41.71
Price: 196.94
Change: +0.19%
Volume: 47.25M
Perf Week: -3.41%
Perf Month: -5.77%
Perf Quarter: -0.64%
Perf Half Y: +8.34%
Perf Year: +18.18%
Perf YTD: +4.59%
Beta: 1.20"></textarea>
            <button id="generateChartsBtn">Generate Charts</button>
        </div>

        <div class="key-metrics">
            <h2>2. Key Metrics</h2>
            <div class="stat-grid">
                <div class="stat-card">
                    <div class="stat-label">Market Cap</div>
                    <div class="stat-value" id="marketCap">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">P/E Ratio</div>
                    <div class="stat-value" id="peRatio">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Current Price</div>
                    <div class="stat-value" id="stockPrice">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Daily Change</div>
                    <div class="stat-value" id="priceChange">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Volume</div>
                    <div class="stat-value" id="volume">-</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Beta</div>
                    <div class="stat-value" id="beta">-</div>
                </div>
            </div>
        </div>

        <div class="chart-section">
            <div class="chart-container">
                <h2>3. Performance Metrics</h2>
                <canvas id="performanceChart"></canvas>
            </div>

            <div class="chart-container">
                <h2>4. Analyst Recommendations</h2>
                <div style="text-align: center;">
                    <canvas id="recommendationGauge" style="max-width: 200px; margin: 0 auto;"></canvas>
                    <div class="rating" id="recommendationRating">-</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Charts
        let performanceChart = null;
        let recommendationChart = null;

        // Parse stock data from text
        function parseStockData(text) {
            const lines = text.split('\n');
            const data = {};

            for (const line of lines) {
                const colonIndex = line.indexOf(':');
                if (colonIndex > 0) {
                    const key = line.substring(0, colonIndex).trim();
                    const value = line.substring(colonIndex + 1).trim();
                    data[key] = value;
                }
            }

            console.log('Parsed stock data:', data);
            return data;
        }

        // Update key metrics
        function updateKeyMetrics(data) {
            const metrics = [
                { id: 'marketCap', keys: ['Market Cap'] },
                { id: 'peRatio', keys: ['P/E'] },
                { id: 'stockPrice', keys: ['Price'] },
                { id: 'priceChange', keys: ['Change'] },
                { id: 'volume', keys: ['Volume'] },
                { id: 'beta', keys: ['Beta'] }
            ];

            for (const metric of metrics) {
                const element = document.getElementById(metric.id);
                if (element) {
                    for (const key of metric.keys) {
                        if (data[key]) {
                            element.textContent = data[key];

                            // Format price change
                            if (metric.id === 'priceChange') {
                                const value = parseFloat(data[key]);
                                if (!isNaN(value)) {
                                    element.className = value > 0 ? 'stat-value trend-positive' :
                                        value < 0 ? 'stat-value trend-negative' : 'stat-value';
                                }
                            }
                            break;
                        }
                    }
                }
            }
        }

        // Create performance chart
        function createPerformanceChart(data) {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            const labels = ['Week', 'Month', 'Quarter', 'Half Year', 'Year', 'YTD'];
            const keys = ['Perf Week', 'Perf Month', 'Perf Quarter', 'Perf Half Y', 'Perf Year', 'Perf YTD'];
            const values = [];

            for (const key of keys) {
                if (data[key]) {
                    // Extract percentage value
                    const valueStr = data[key].replace('%', '').replace('+', '');
                    const value = parseFloat(valueStr);
                    values.push(isNaN(value) ? 0 : value);
                    console.log(`Performance data ${key}: ${value}`);
                } else {
                    values.push(0);
                    console.log(`No data for ${key}`);
                }
            }

            // Destroy existing chart if it exists
            if (performanceChart) {
                performanceChart.destroy();
            }

            performanceChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Performance (%)',
                        data: values,
                        backgroundColor: values.map(value =>
                            value >= 0 ? 'rgba(76, 175, 80, 0.6)' : 'rgba(244, 67, 54, 0.6)'
                        ),
                        borderColor: values.map(value =>
                            value >= 0 ? 'rgba(76, 175, 80, 1)' : 'rgba(244, 67, 54, 1)'
                        ),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Performance (%)'
                            },
                            ticks: {
                                callback: function (value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Create recommendation gauge
        function createRecommendationGauge(data) {
            const ctx = document.getElementById('recommendationGauge').getContext('2d');
            const ratingElement = document.getElementById('recommendationRating');

            let recomValue = 3; // Default neutral
            let recomText = 'Hold';

            if (data['Recom']) {
                recomValue = parseFloat(data['Recom']);

                if (recomValue <= 1.5) {
                    recomText = 'Strong Buy';
                    ratingElement.className = 'rating rating-strong';
                } else if (recomValue <= 2.5) {
                    recomText = 'Buy';
                    ratingElement.className = 'rating rating-good';
                } else if (recomValue <= 3.5) {
                    recomText = 'Hold';
                    ratingElement.className = 'rating rating-neutral';
                } else if (recomValue <= 4.5) {
                    recomText = 'Sell';
                    ratingElement.className = 'rating rating-warning';
                } else {
                    recomText = 'Strong Sell';
                    ratingElement.className = 'rating rating-poor';
                }

                ratingElement.textContent = `${recomText} (${recomValue})`;
            }

            // Destroy existing chart if it exists
            if (recommendationChart) {
                recommendationChart.destroy();
            }

            recommendationChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [recomValue, 5 - recomValue],
                        backgroundColor: [
                            recomValue <= 1.5 ? '#2e7d32' :
                                recomValue <= 2.5 ? '#4CAF50' :
                                    recomValue <= 3.5 ? '#9e9e9e' :
                                        recomValue <= 4.5 ? '#f9a825' : '#f44336',
                            'rgba(220, 220, 220, 0.5)'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        tooltip: { enabled: false },
                        legend: { display: false }
                    }
                }
            });
        }

        // Event handler for the Generate Charts button
        document.getElementById('generateChartsBtn').addEventListener('click', function () {
            const inputText = document.getElementById('stockDataInput').value;
            if (!inputText) {
                alert('Please enter some stock data first.');
                return;
            }

            const data = parseStockData(inputText);
            updateKeyMetrics(data);
            createPerformanceChart(data);
            createRecommendationGauge(data);
        });
    </script>
</body>

</html>